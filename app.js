// $- хранит дом элемент

const APIKEY = '8b20b4a6284aaf23b99f610d7a2154a1';
const $cardsBox = document.getElementById('cards-box');
const $locationForm = document.getElementById('form-location');
const $locationInput = document.getElementById('form-location-input');
const $body = document.querySelector('body');
let currentCard = null;

// модальное окно
const modal = document.getElementById('modal');
const closeBtn = document.querySelector('.modal__close-btn');

closeBtn.addEventListener('click', () => {
    modal.classList.remove('modal_open');
})

async function getWeatherData(location) {
    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${location}&appid=${APIKEY}&units=metric&lang={ru}`)


    if (response.ok) { // если HTTP-статус в диапазоне 200-299
        // получаем тело ответа (см. про этот метод ниже)
        let data = await response.json();
        return data;
    } else {

        if (response.status === 404) {
            // alert("Ошибка HTTP: " + response.status);
            modal.classList.add('modal_open');
        }
        // alert("Введите корректное название населенного пункта");

    }
    // const data = await response.json();
    //
    // return data;
}

function getNewCard(title,) {
    const $card = document.createElement('div');
    $card.classList.add('card');

    $card.innerHTML = `
    <div class="card__inner">
                    <!--шапка-->
                    <div class="card__header">
                        <div class="card__header-left">
                            <div class="card__icon"></div>
                            <div class="card__header-left-title">
                                <h2 class="card__title">${title}</h2>
                                <span class="card__desc">Снегопад</span>
                            </div>
                        </div>
                        <div class="card__header-right card-param">
                            <svg class="card-param__icon" xmlns="http://www.w3.org/2000/svg"
                                 xmlns:xlink="http://www.w3.org/1999/xlink"
                                 width="100px" height="100px" viewBox="0 0 100 100" version="1.1">
                                <g id="surface1">
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 35.5 3.351562 C 33.800781 4.25 32.199219 5.601562 31.25 6.949219 L 29.75 9.101562
                                      L 29.601562 37.351562 L 29.5 65.648438
                                      L 27.449219 67.851562 C 24.101562 71.5 22.75 75 22.75 80 C 22.75 83.601562
                                      22.949219 84.699219 24.148438 87.25 C 25.949219 91.148438 29.351562 94.550781
                                       33.199219 96.351562 C 35.800781 97.550781 36.898438 97.75 40.5 97.75 C 44.101562 97.75
                                       45.199219 97.550781 47.851562 96.300781 C 51.648438 94.550781 55.050781 91.101562 56.898438 87.101562 C 58 84.75 58.199219 83.550781 58.25 80 C 58.25 76.398438 58.050781 75.300781 56.898438 72.898438 C 56.199219 71.351562 54.699219 69.101562 53.550781 67.851562 L 51.550781 65.648438 L 51.398438 37.148438 L 51.25 8.648438 L 49.851562 6.648438 C 48 3.949219 45.101562 2.449219 41.300781 2.148438 C 38.648438 1.949219 37.898438 2.101562 35.5 3.351562 Z M 44.898438 7.351562 C 47.550781 9.300781 47.5 8.699219 47.5 39.101562 L 47.5 67.449219 L 49.550781 69.351562 C 52.851562 72.398438 54.199219 75.550781 54.199219 80 C 54.199219 83.101562 54 84.199219 52.898438 86.300781 C 50.449219 90.949219 45.550781 94 40.5 94 C 33 94 26.5 87.5 26.5 80 C 26.5 76.351562 27.898438 73.101562 30.800781 70.101562 L 33.5 67.300781 L 33.5 38.851562 C 33.5 7.550781 33.398438 8.449219 36.601562 6.800781 C 38.800781 5.699219 43.050781 5.949219 44.898438 7.351562 Z M 44.898438 7.351562 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 39.101562 31.601562 C 38.648438 32.050781 38.5 37.050781 38.5 51.050781 L 38.5
                                      69.851562 L 36.148438 71.101562
                                      C 34.75 71.800781 33.148438 73.199219 32.25 74.449219 C 30.949219 76.300781
                                      30.75 77 30.75 79.898438 C 30.75 82.550781 31 83.648438 31.949219 85.148438 C
                                       35.300781 90.601562 43 91.5 47.5 87 C 51.75 82.75 51.199219 75.449219 46.351562 71.949219
                                        C 45.25 71.148438 43.949219 70.5 43.398438 70.5 C 42.550781 70.5 42.5 69.648438 42.5
                                        51.351562 C 42.5 31.601562 42.449219 31 40.5 31 C 40.050781 31 39.449219 31.25 39.101562
                                        31.601562 Z M 44.699219 75.949219 C 46 77.300781 46.25 77.898438 46.25 80 C 46.25 82.101562
                                        46 82.699219 44.75 84 C 39.800781 88.949219 31.800781 82.949219 35.351562 76.949219 C
                                         37.300781 73.648438 41.898438 73.199219 44.699219 75.949219 Z M 44.699219 75.949219 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 56.148438 8.351562 C 55.800781 8.449219 55.5 9.25 55.5 10.050781 C 55.5 12 55.949219
                                       12.050781 67.199219 11.898438
                                      C 75.550781 11.75 76.699219 11.648438 77.199219 10.851562 C 77.601562 10.25
                                      77.601562 9.75 77.199219 9.101562 C 76.699219 8.351562 75.550781 8.25 66.699219
                                       8.148438 C 61.25 8.101562 56.449219 8.199219 56.148438 8.351562 Z M 56.148438 8.351562 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 56.148438 18.300781 C 55.800781 18.449219 55.5 19.25 55.5 20.050781 C 55.5 21.851562
                                       56.300781 22.101562 62.199219 21.898438
                                      C 65.800781 21.800781 66.75 21.601562 67.199219 20.851562 C 67.601562 20.25
                                      67.601562 19.75 67.199219 19.101562 C 66.75 18.398438 65.800781 18.25 61.699219
                                       18.148438 C 59 18.101562 56.449219 18.199219 56.148438 18.300781 Z M 56.148438 18.300781 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 56.148438 28.351562 C 55.800781 28.449219 55.5 29.25 55.5 30.050781 C 55.5 32
                                      55.949219 32.050781 67.199219 31.898438
                                      C 75.550781 31.75 76.699219 31.648438 77.199219 30.851562 C 77.601562 30.25
                                      77.601562 29.75 77.199219 29.101562 C 76.699219 28.351562 75.550781 28.25 66.699219
                                       28.148438 C 61.25 28.101562 56.449219 28.199219 56.148438 28.351562 Z M 56.148438 28.351562 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 56.148438 38.300781 C 55.800781 38.449219 55.5 39.25 55.5 40.050781 C 55.5 41.851562
                                      56.300781 42.101562 62.199219 41.898438
                                      C 65.800781 41.800781 66.75 41.601562 67.199219 40.851562 C 67.601562 40.25
                                      67.601562 39.75 67.199219 39.101562 C 66.75 38.398438 65.800781 38.25 61.699219
                                       38.148438 C 59 38.101562 56.449219 38.199219 56.148438 38.300781 Z M 56.148438 38.300781 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 56.148438 48.351562 C 55.800781 48.449219 55.5 49.25 55.5 50.050781 C 55.5 52 55.949219
                                       52.050781 67.199219 51.898438
                                      C 75.550781 51.75 76.699219 51.648438 77.199219 50.851562 C 77.601562 50.25
                                      77.601562 49.75 77.199219 49.101562 C 76.699219 48.351562 75.550781 48.25 66.699219
                                       48.148438 C 61.25 48.101562 56.449219 48.199219 56.148438 48.351562 Z M 56.148438 48.351562 "/>
                                    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;"
                                          d="M 56.148438 58.300781 C 55.800781 58.449219 55.5 59.25 55.5 60.050781 C 55.5 61.851562
                                      56.300781 62.101562 62.199219 61.898438
                                      C 65.800781 61.800781 66.75 61.601562 67.199219 60.851562 C 67.601562 60.25
                                      67.601562 59.75 67.199219 59.101562 C 66.75 58.398438 65.800781 58.25 61.699219
                                       58.148438 C 59 58.101562 56.449219 58.199219 56.148438 58.300781 Z M 56.148438 58.300781 "/>
                                </g>
                            </svg>
                            <span class="card-param__text">
                            <span class="card-param-value card-param-value-temp">13</span>
                            &deg;C
                        </span>
                        </div>
                    </div>

                    <!--подвал-->
                    <div class="card__footer">
                        <div class="card__footer-left card-param">
                            <svg class="card-param__icon card-param__icon_footer" version="1.1" id="Capa_1"
                                 xmlns="http://www.w3.org/2000/svg"
                                 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 409.6 409.6"
                                 style="enable-background:new 0 0 409.6 409.6;" xml:space="preserve"><g><g><path d="M327.552,45.867c-26.066,0-50.831,
                             12.575-66.243,33.628c-1.669,2.284-1.172,5.489,1.106,7.158 c2.289,1.674,5.489,1.172,7.158-1.106c13.491-18.437,35.169-29.44,
                             57.979-29.44c39.593,0,71.808,32.215,71.808,71.803 c0,39.593-32.215,71.808-71.808,71.808H5.12c-2.826,0-5.12,2.294-5.12,
                             5.12s2.294,5.12,5.12,5.12h322.432 c45.24,0,82.048-36.808,82.048-82.048S372.792,45.867,327.552,45.867z"></path></g></g>
                                <g><g><path d="M178.724,81.375c-14.787,0-28.836,7.132-37.576,19.077c-1.669,2.284-1.172,5.489,1.106,7.158 c2.289,1.669,
                            5.489,1.172,7.158-1.106c6.82-9.318,17.777-14.884,29.312-14.884c20.014,0,36.296,16.282,36.296,36.296 c0,20.014-16.282,
                            36.301-36.296,36.301H5.12c-2.826,0-5.12,2.294-5.12,5.12s2.294,5.115,5.12,5.115h173.604 c25.661,0,46.536-20.879,
                            46.536-46.541S204.38,81.375,178.724,81.375z"></path></g></g>
                                <g><g><path d="M258.621,232.538H5.12c-2.826,0-5.12,2.294-5.12,5.12s2.294,5.12,5.12,5.12h253.501c30.525,0,55.357,24.837,
                            55.357,55.357 c0,30.52-24.837,55.357-55.357,55.357c-17.587,0-34.299-8.484-44.703-22.697c-1.669-2.278-4.869-2.775-7.158-1.106
                            c-2.278,1.674-2.775,4.874-1.106,7.158c12.324,16.835,32.128,26.885,52.966,26.885c36.173,0,65.597-29.43,65.597-65.597 C324.219,
                            261.967,294.789,232.538,258.621,232.538z"></path></g></g></svg>
                            <span class="card-param__text_footer">
                            <span class="card-param-value card-param-value-wind">13</span>
                            m/s
                        </span>
                        </div>
                        <div class="card__footer-right card-param">
                            <svg class="card-param__icon card-param__icon_footer"
                                 viewBox="0 0 48 48"
                                 xmlns="http://www.w3.org/2000/svg">
                                <g id="Drop,-humid,-humidity,-precipitation,-water-icon"
                                   fill="none" fill-rule="evenodd">
                                    <path id="Shape" d="m29 5c3.2676565 0 14 17.3378431 14 24 0
                                        7.7319865-6.2680135 14-14 14-1.8234224 0-3.5999689-.34926-5.2553412-1.0201036-.5118513-.207429-.7586343-.7905208-.5512053-1.302372.2074289-.5118512.7905207-.7586342
                                         1.3023719-.5512053 1.4177455.5745448 2.9393317.8736809
                                        4.5041746.8736809 6.627417 0 12-5.4532752 12-12-.2220469-6.9705293-10.0601234-20.90802269-12.078-21.985-2.0754163 1.14432849-8.4873932
                                        11.5852723-10.0993402 15.4114484-.2218312.505776-.8116733.7359588-1.3174494.5141277-.505776-.2218312-.7359588-.8116733-.5141277-1.3174493
                                        1.8315771-4.6500302 9.1583104-16.37679882 12.0089173-16.6231268zm-5.0000003 30.999986c.552283 0 1 .4477293 1 1.0000137 0 .5128361-.3911693
                                        1-1 1-1.5370879.0000358-2.7233817 2.0000356-4.9973357 2.0000356-2.2739539 0-3.4293273-2.0000087-5.0026643-2.0000356s-2.6982845 2.0000356-5.00000002
                                        2.0000356c-1.59930911 0-3.16737688-.7840232-4.69990424-2.2857989-.39446186-.3865466-.40087844-1.0196791-.01433182-1.414141.38654661-.3944618
                                         1.01967907-.4008784 1.41414094-.0143318 1.18876551 1.1649118 2.28743872 1.7142719 3.30009512 1.7142569 1.40216222-.0000208 2.68434742-2.0002022
                                          5.00000002-2.0000345 2.3156526.000195 3.4960088 2.0000624 4.9973154 2.0000381 1.5013065-.0000244 2.5498602-1.9998431 5.0026846-2.0000381zm-18.30009514-3.7142224c1.18875407
                                           1.1649006 2.28742563 1.7142361 3.30009512 1.7142361.55228507 0 1 .4477156 1 1 0 .552285-.44771493 1-1 1-1.59939166
                                           0-3.16738677-.7839973-4.69990424-2.2857633-.39446186-.3865466-.40087844-1.0196791-.01433182-1.414141.38654661-.3944618
                                           1.01967907-.4008784 1.41414094-.0143318zm18.30009544-.2857637c2.4081466-.0000472 3.5702443 2 5.0097308 2.0000474 1.0064906.0097944
                                           2.1005282-.5372244 3.286985-1.7109561.3926241-.3884132 1.0257799-.3849995 1.414193.0076246.3884132.3926241.3849995 1.0257799-.0076246
                                           1.414193-1.5348148 1.5183535-3.1053795 2.2890439-4.713015 2.2890439-2.3144458 0-3.4046357-1.9999528-4.9902692-1.9999528s-2.706099
                                           2.0001811-4.9973255 2-3.4225294-1.9999094-5.0026745-2c-.5522847 0-1-.4477152-1-1
                                        0-.5522846.4477153-1 1-1 2.3937549.0001811 3.531381 1.9999095 4.9973255 2 1.4659446.0000906 2.5945279-1.9999527
                                        5.0026745-2zm-10.0000003-4.0000002c.552285 0 1 .4477156 1 1 0 .5128361-.3968671 1-1 1-1.583846 0-2.7182385 1.999953-5.00000002
                                        2-1.59939166 0-3.16738677-.7839973-4.69990424-2.2857633-.39446186-.3865466-.40087844-1.0196791-.01433182-1.414141.38654661-.3944618
                                        1.01967907-.4008784 1.41414094-.0143318 1.18875407 1.1649006 2.28742563 1.7142361 3.30009512 1.7142361 1.62804702 0 2.49811312-1.9999462
                                        5.00000002-2zm10.0000002.0000002c2.3181813 0 3.5175942 1.9932724 5.0097309 2.0000474 1.0064906.0097944 2.1005282-.5372244 3.286985-1.7109561.3926241-.3884132
                                        1.0257799-.3849995 1.414193.0076246.3884132.3926241.3849995 1.0257799-.0076246 1.414193-1.5348148 1.5183535-3.106228 2.2890439-4.713015 2.2890439-2.2671532
                                        0-3.4052078-1.9932252-4.9902693-1.9999528s-2.6769797
                                        1.9999528-4.9973254 2c-.5522828.0014736-1.0011939-.4450427-1.0027506-.9973254-.0013974-.5522828.4451189-1.0011939.9974016-1.0026746 1.4444718-.0067276
                                         2.6844931-2 5.0026744-2zm-.0000002-4.0000002c.552285 0 1 .4477156 1 1 0 .5128361-.4221739 1.0000269-1 1-1.6597396-.0000773-2.6566052 1.9938441-4.9973357
                                         2.0000356s-3.4067726-2.0000356-5.0026643-2.0000356-2.6531918 2-5.00000002 2.0000356c-1.59938429 0-3.16737688-.7840232-4.69990424-2.2857989-.39446186-.3865466-.40087844-1.0196791-.01433182-1.414141.38654661-.3944618 1.01967907-.4008784
                                         1.41414094-.0143318 1.18876551 1.1649118 2.28743872 1.7142569 3.30009512 1.7142569 1.45065932-.0067482 2.63946702-2.0000208 5.00000002-2.0000208 2.3605329 0 3.5052107 2.0039994 4.9973154
                                          2.0000244 1.4921046-.0039751 2.6072607-2.0000244 5.0026846-2.0000244z" fill="rgb(0,0,0)" fill-rule="nonzero"></path>
                                </g>
                            </svg>
                            <span class="card-param__text_footer">
                            <span class="card-param-value card-param-value-humidity">13</span>
                            %
                        </span>
                        </div>
                    </div>
                </div>
    `
    return {
        $card,
        $icon: $card.querySelector('.card__icon'),
        $title: $card.querySelector('.card__title'),
        $temp: $card.querySelector('.card-param-value-temp'),
        $desc: $card.querySelector('.card__desc'),
        $wind: $card.querySelector('.card-param-value-wind'),
        $humidity: $card.querySelector('.card-param-value-humidity'),
    };
}

$locationForm.addEventListener('submit', function (event) {
    event.preventDefault();


    const newCard = getNewCard();
    const location = $locationInput.value.trim();
    // console.log(location);
    $locationInput.value = '';

    $cardsBox.prepend(newCard.$card);
    setTimeout(async function () {
        newCard.$card.classList.add('loading');

        const data = await getWeatherData(location);
        newCard.$icon.style.backgroundImage = `url(https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png)`;
        newCard.$title.textContent = data.name;
        newCard.$desc.textContent = data.weather[0].description;
        newCard.$temp.textContent = data.main.temp;
        newCard.$wind.textContent = data.wind.speed;
        newCard.$humidity.textContent = data.main.humidity;
        // console.log(data);

        setTimeout(function () {

            // смена стиля формы
            document.querySelector('.app__container').classList.add('app__container_top');

            $body.style.backgroundImage = `url(img/bg/${data.weather[0].icon}.jpg)`

            if (currentCard !== null) {
                currentCard.$card.classList.remove('full');
                currentCard.$card.classList.add('glass');
            }

            currentCard = newCard;

            newCard.$card.classList.remove('loading');
            newCard.$card.classList.add('full');
        }, 600)
    }, 30);
})